# Simple Storage Service (S3)

Is a global storage service that can be accessed over the internet. Can be used to store and retrieve **any amount** ("infinitely scaling") of data, from anywhere.

It automatically handles backups (stores data across multiple facilities)

Data are stored as `objects` within `buckets`, and the name of each bucket must be unique.

Properties exist on both levels (`objects` & `buckets`) so permissions can be set.

In conjunction with [EFS](./efs.md) we do not need to mount a file system. We can programmatically access the data, even though it is possible to mount to a drive.

> [!IMPORTANT]
> To find differences between [EBS](./ebs.md), [EFS](./efs.md), [Instance store](./ec2.md#5-ec2-instance-store) and [S3](./s3.md) read [this](./ebs-vs-efs-vs-instance-store-vs-s3.md).
> Other storing services: [Amazon FSx](./fsx.md).

```mermaid
flowchart LR
    A[Amazon S3] --> B[Bucket]
    B --> C[Folder]
    C --> D[Object]
    D <--> E[Public Access]
    style A fill:#FF6B6B
    style B fill:#FF6B6B
    style C fill:#0066CC
    style D fill:#FF6B6B
    style E fill:#FFFFFF,stroke:#000
```

> **Note**
> Useful info:
> 
> **Bucket** is actually a kind of directory
> **Object** is the file that is stored
> **Bucket name** must be unique across all regions
> **Buckets** are defined at a region level but are accessable globally
>

## Common Use Case

```mermaid
flowchart LR
    A[EC2] <--> F[Bucket]
    B[EC2] <--> F
    F <--> C[EC2]
    F <--> D[EC2]
    
    style A fill:#0066CC
    style B fill:#0066CC
    style C fill:#0066CC
    style D fill:#0066CC
    
```

## Objects
Objects have **keys**, which is the **FULL** path of the file. There are **NOT** actually directories, even though the key seems to contain them.

```mermaid
flowchart TD
    TL(["<b>Key contents:</b>"]):::titleStyle
    classDef titleStyle fill:none,stroke:none,font-size:16px,text-align:left;

    s3["s3://"]
    style s3 opacity:0,height:1,width:0.01,color:#f00

    bucket-name["bucket-name/"]
    style bucket-name opacity:0,height:1,width:30,color:#6d7

    prefix["folder1/folder2/"]
    style prefix opacity:0,height:1,width:75,color:#fc7e51

    object["file_name.txt"]
    style object opacity:0,height:1,width:25,color:#5eb9ff

    expl-prefix["\* Prefix"]
    style expl-prefix opacity:0,height:1,width:75,color:#fc7e51

    expl-obj["\* Object name"]
    style expl-obj opacity:0,height:1,width:25,color:#5eb9ff
```

> [!WARNING]
> Limitations:
>
> * For files > 5Gb use `multi-part upload`
> * Object size must be <= 5TB

Each object can also have **metadata** and **tags**.

### Example: Create a public bucket
By default all objects that stored in buckets are private. To create a bucket and make it publicly available:

#### 1. Enable ACL
- Select bucket
- `Permissions`
- `Object Ownership`
- `Enable ACLs`
- Set also `Block public access (bucket settings)` to `off`

#### 2. Make them public 
- Select bucket
- `Actions`
- `Make public using ACL`

---

## [Storage Classes](https://aws.amazon.com/s3/storage-classes/)
| Storage Class                          | S3 Standard                     | S3 Intelligent-Tiering*         | S3 Express One Zone**            | S3 Standard-IA                   | S3 One Zone-IA**                 | S3 Glacier Instant Retrieval       | S3 Glacier Flexible Retrieval***  | S3 Glacier Deep Archive***         |
|----------------------------------------|----------------------------------|----------------------------------|-----------------------------------|----------------------------------|-----------------------------------|------------------------------------|------------------------------------|------------------------------------|
| **Use Cases**                          | General purpose storage for frequently accessed data | Automatic cost savings for data with unknown or changing access patterns | High performance storage for your most frequently accessed data | Infrequently accessed data that needs millisecond access | Re-creatable infrequently accessed data | Long-lived data that is accessed a few times per year with instant retrievals | Backup and archive data that is rarely accessed and low cost | Archive data that is very rarely accessed and very low cost |
| **First Byte Latency**                 | milliseconds                    | milliseconds                    | single-digit milliseconds         | milliseconds                    | milliseconds                     | milliseconds                       | minutes or hours                   | hours                              |
| **Durability**                         | Amazon S3 provides the most durable storage in the cloud. Based on its unique architecture, S3 is designed to exceed 99.999999999% (11 nines) data durability. Additionally, S3 stores data redundantly across a minimum of 3 Availability Zones by default, providing built-in resilience against widespread disaster. Customers can store data in a single AZ to minimize storage cost or latency, in multiple AZs for resilience against the permanent loss of an entire data center, or in multiple AWS Regions to meet geographic resilience requirements. |
| **Designed for Availability**          | 99.99%                          | 99.9%                           | 99.95%                            | 99.9%                           | 99.5%                            | 99.9%                              | 99.99%                             | 99.99%                             |
| **Availability SLA**                   | 99.9%                           | 99%                             | 99.9%                             | 99%                              | 99%                               | 99.9%                              | 99.9%                              | 99.9%                              |
| **Availability Zones**                 | ≥3                              | ≥3                              | 1                                 | ≥3                              | 1                                | ≥3                                 | ≥3                                 | ≥3                                 |
| **Minimum Storage Duration Charge**    | N/A                             | N/A                             | 1 hour                            | 30 days                          | 30 days                          | 90 days                            | 90 days                            | 180 days                           |
| **Retrieval Charge**                   | N/A                             | N/A                             | N/A                               | per GB retrieved                | per GB retrieved                | per GB retrieved                  | per GB retrieved                  | per GB retrieved                  |
| **Lifecycle Transitions**              | Yes                             | Yes                             | No                                | Yes                             | Yes                              | Yes                               | Yes                               | Yes                               |


---

## CLI

List Buckets
`aws s3 ls`

List Objects in a Bucket
`aws s3 ls s3://<bucket-name>/`

Create a Bucket
`aws s3 mb s3://<bucket-name>`

Upload a File
`aws s3 cp <myfile.txt> s3://<bucket-name>/`

Download a File
`aws s3 cp s3://<bucket-name>/myfile.txt <local-file-path>`

Delete an Object
`aws s3 rm s3://<bucket-name>/<file-name>`

Delete a Bucket
`aws s3 rb s3://<bucket-name> --force`